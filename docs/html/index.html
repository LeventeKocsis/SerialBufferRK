<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SerialBufferRK: SerialBufferRK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SerialBufferRK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SerialBufferRK </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em>Serial buffer for the Particle Photon, P1, and Electron to make dealing with receiving data, especially at higher data rates, more reliable by implementing a larger buffer.</em></p>
<p><a href="http://rickkas7.github.io/SerialBufferRK/">Full browsable API documentation</a> is available.</p>
<p>SerialBufferRK creates a thread to continuously read from the hardware serial port and copy the data into a thread-safe ring buffer. You can choose the size of the ring buffer.</p>
<p>You could then read the data at your leisure out of loop. The USART serial buffer is only 64 bytes, but by using a much larger buffer (say, 4096 bytes or even larger) you can greatly reduce the likelihood of lost data.</p>
<h2>Using it</h2>
<p>If you are using Particle Build (Web IDE), search for the library <code>SerialBufferRK</code> and add it.</p>
<p>From the Particle CLI you can add the library to your project (CLI or Particle Dev Atom IDE) by using:</p>
<div class="fragment"><div class="line">particle library add SerialBufferRK</div></div><!-- fragment --><p>Add the header file if necessary:</p>
<div class="fragment"><div class="line">#include &quot;SerialBufferRK.h&quot;</div></div><!-- fragment --><p>In many cases you will use it with system thread enabled mode. It's not required, however. While the serial buffer uses threads, it does not require the system thread.</p>
<div class="fragment"><div class="line">SYSTEM_THREAD(ENABLED);</div></div><!-- fragment --><p>You need to allocate a <a class="el" href="class_serial_buffer.html" title="Buffered serial class. ">SerialBuffer</a> object, typically as a global variable.</p>
<div class="fragment"><div class="line">SerialBuffer&lt;4096&gt; serBuf(Serial1);</div></div><!-- fragment --><p>This allocates a 4096 byte serial buffer connected to Serial1.</p>
<p>Whenever you would read from Serial1, you should instead read from serBuf. This includes using things like available() and read() as well as the Wiring/Aruduino functions like find(), readStringUntil(), etc.</p>
<div class="fragment"><div class="line">int c = serBuf.read();</div></div><!-- fragment --><p>You should read all of the bytes available, calling until read() return -1 or use available() to determine if there are available bytes to read.</p>
<p>You do not need to use serBuf for writing, though you can if you want.</p>
<p>Make sure you never mix reads from serBuf and the actual serial port (Serial1, etc.) as the data will be corrupted.</p>
<p>You still need to initialize the serial port, you should do that from setup():</p>
<div class="fragment"><div class="line">Serial1.begin(230400);</div></div><!-- fragment --><h2>Full Example</h2>
<div class="fragment"><div class="line">#include &quot;Particle.h&quot;</div><div class="line"></div><div class="line">#include &quot;SerialBufferRK.h&quot;</div><div class="line"></div><div class="line">SYSTEM_THREAD(ENABLED);</div><div class="line"></div><div class="line">SerialLogHandler logHandler;</div><div class="line"></div><div class="line">// Allocate a serial buffer of 256 bytes attached to Serial1</div><div class="line">// call serBuf.read() instead of Serial1.read()</div><div class="line">SerialBuffer&lt;4096&gt; serBuf(Serial1);</div><div class="line"></div><div class="line">unsigned long lastDisplay = 0;</div><div class="line">int totalReceived = 0;</div><div class="line"></div><div class="line">void setup() {</div><div class="line">    Serial.begin();</div><div class="line">    Serial1.begin(230400);</div><div class="line">}</div><div class="line"></div><div class="line">void loop() {</div><div class="line">    while(true) {</div><div class="line">        int c = serBuf.read();</div><div class="line">        if (c &lt; 0) {</div><div class="line">            break;</div><div class="line">        }</div><div class="line"></div><div class="line">        totalReceived++;</div><div class="line">    }</div><div class="line"></div><div class="line">    if (millis() - lastDisplay &gt;= 5000) {</div><div class="line">        lastDisplay = millis();</div><div class="line"></div><div class="line">        Log.info(&quot;totalReceived=%u&quot;, totalReceived);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2>Test Code</h2>
<p>In the examples directory, there are two examples for testing:</p>
<ul>
<li>2-test-receiver-SerialBufferRK</li>
<li>3-test-sender-SerialBufferRK</li>
</ul>
<p>You can test the library by connecting two devices RX -&gt; TX and TX -&gt; RX and running one sender and one receiver.</p>
<p>The sender and receiver use the same linear congruential generator pseudo-random number generator with the same seed, so the data can be verified by lots of different bit change sequences are tested.</p>
<p>Monitor the serial output on the receiver.</p>
<div class="fragment"><div class="line">0000948089 [app] INFO: numReceived=115385 maxInBuffer=45 totalReceived=21669298</div><div class="line">0000953089 [app] INFO: numReceived=115385 maxInBuffer=46 totalReceived=21784683</div><div class="line">0000958089 [app] INFO: numReceived=115385 maxInBuffer=45 totalReceived=21900068</div><div class="line">0000963089 [app] INFO: numReceived=115385 maxInBuffer=43 totalReceived=22015453</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
